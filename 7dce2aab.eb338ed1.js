(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{192:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return r})),a.d(t,"rightToc",(function(){return s})),a.d(t,"default",(function(){return p}));var n=a(2),l=a(11),c=(a(0),a(241)),o={id:"channel-check",title:"Check for New Channels",sidebar_label:"Check for New Channels"},r={id:"slack-apps/tutorials/channel-check",isDocsHomePage:!1,title:"Check for New Channels",description:"It can be hard to keep up with all of the changes in your Slack workspace! This tutorial will walk you through how to build a simple tool in Dark that posts all new, public Slack channels created in your Slack workspace in the past 24 hours.",source:"@site/docs/slack-apps/tutorials/channel-check.md",permalink:"/docs/slack-apps/tutorials/channel-check",sidebar_label:"Check for New Channels",sidebar:"Slack",previous:{title:"Slack Packages",permalink:"/docs/slack-apps/slack-packages"},next:{title:"Create Asana Projects & Tasks",permalink:"/docs/slack-apps/tutorials/asana-tutorial"}},s=[{value:"Slack Configuration",id:"slack-configuration",children:[]},{value:"Building in Dark",id:"building-in-dark",children:[]}],i={rightToc:s};function p(e){var t=e.components,a=Object(l.a)(e,["components"]);return Object(c.b)("wrapper",Object(n.a)({},i,a,{components:t,mdxType:"MDXLayout"}),Object(c.b)("p",null,"It can be hard to keep up with all of the changes in your Slack workspace! This tutorial will walk you through how to build a simple tool in Dark that posts all new, public Slack channels created in your Slack workspace in the past 24 hours."),Object(c.b)("p",null,"A full sample canvas for this tutorial is available ",Object(c.b)("a",Object(n.a)({parentName:"p"},{href:"https://darklang.com/a/sample-slackchannelcheck"}),"here"),"."),Object(c.b)("h2",{id:"slack-configuration"},"Slack Configuration"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},Object(c.b)("a",Object(n.a)({parentName:"li"},{href:"https://api.slack.com/apps"}),"Create a new app in Slack"),"."),Object(c.b)("li",{parentName:"ol"},"Navigate to ",Object(c.b)("strong",{parentName:"li"},"Features -> OAuth& Permissions"),", scroll down to scopes and add the following bot token scopes: ",Object(c.b)("inlineCode",{parentName:"li"},"channels:manage"),", ",Object(c.b)("inlineCode",{parentName:"li"},"channels:read"),", ",Object(c.b)("inlineCode",{parentName:"li"},"chat:write"),", and ",Object(c.b)("inlineCode",{parentName:"li"},"chat:write.public"),". This will allow our app to interact with our the channels (also known as conversations) and post messages about them.")),Object(c.b)("p",null,Object(c.b)("img",Object(n.a)({parentName:"p"},{src:"assets/slack-apps/tutorials/channelcheck/bottokenscopes.png",alt:"assets/slack-apps/tutorials/channelcheck/bottokenscopes.png"}))),Object(c.b)("ol",{start:3},Object(c.b)("li",{parentName:"ol"},"Install your app to the workspace (either via ",Object(c.b)("strong",{parentName:"li"},"Settings -> Basic Information")," or ",Object(c.b)("strong",{parentName:"li"},"Settings -> Install App"),"). Since this app is being built for your workspace specifically, we will not need to set up full OAuth, like we would if we wanted to distribute this more publicly."),Object(c.b)("li",{parentName:"ol"},"Copy your bot user access token, which will now be available under ",Object(c.b)("strong",{parentName:"li"},"Settings -> Install")," app and save it as a function in your Dark canvas. Use this function wherever you see ",Object(c.b)("inlineCode",{parentName:"li"},"token")," in the code examples."),Object(c.b)("li",{parentName:"ol"},"If no new channels have been created in your Slack recently, create a new public channel so we have some data to work with."),Object(c.b)("li",{parentName:"ol"},"You will need to choose a Slack channel to post your messages to. You can find your Slack channel's id by navigating to the channel and looking for the 11 character string that begins with a capital C - it will look something like ",Object(c.b)("inlineCode",{parentName:"li"},"C1234567891"),". Add that to its own Dark function as well, and use it wherever you see ",Object(c.b)("inlineCode",{parentName:"li"},"channel")," in the code examples.")),Object(c.b)("h2",{id:"building-in-dark"},"Building in Dark"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"Create a new daily Cron named ",Object(c.b)("inlineCode",{parentName:"li"},"checkForNewChannels")," by clicking the + in the sidebar next to Cron, and call the ",Object(c.b)("a",Object(n.a)({parentName:"li"},{href:"../slack-packages#getnewconversations"}),Object(c.b)("inlineCode",{parentName:"a"},"getNewConversations")," Slack function")," (it's a little confusing, but channels are referred to as conversations in the Slack API). The ",Object(c.b)("inlineCode",{parentName:"li"},"getNewConversations")," function is built into Dark's ",Object(c.b)("a",Object(n.a)({parentName:"li"},{href:"./../../packages"}),"package manager"),", and it takes your token as well as an amount of time to check in Epoch seconds. Here, we're asking it to check in the past 24 hours, which is equivalent to 86400 seconds.")),Object(c.b)("p",null,Object(c.b)("img",Object(n.a)({parentName:"p"},{src:"assets/slack-apps/tutorials/channelcheck/checkfornewchannels.png",alt:"assets/slack-apps/tutorials/channelcheck/checkfornewchannels.png"}))),Object(c.b)("ol",{start:2},Object(c.b)("li",{parentName:"ol"},"Click the play button on the ",Object(c.b)("a",Object(n.a)({parentName:"li"},{href:"../slack-packages#getnewconversations"}),Object(c.b)("inlineCode",{parentName:"a"},"getNewConversations")," function")," and then place your carat in ",Object(c.b)("inlineCode",{parentName:"li"},"newChannels"),". You will see a list of information about any new channels that have been created.")),Object(c.b)("p",null,Object(c.b)("img",Object(n.a)({parentName:"p"},{src:"assets/slack-apps/tutorials/channelcheck/checkfornewchannelslive.png",alt:"assets/slack-apps/tutorials/channelcheck/checkfornewchannelslive.png"}))),Object(c.b)("ol",{start:3},Object(c.b)("li",{parentName:"ol"},"Create a function called ",Object(c.b)("inlineCode",{parentName:"li"},"formatChannelList")," with a ",Object(c.b)("inlineCode",{parentName:"li"},"channelList")," parameter. This is where we're going to build the format of the messages Slack will print about your new channels, but for now, just return ",Object(c.b)("inlineCode",{parentName:"li"},"channelList"),". You'll notice that an error is shown - this is because ",Object(c.b)("inlineCode",{parentName:"li"},"channelList")," has not yet been set.")),Object(c.b)("p",null,Object(c.b)("img",Object(n.a)({parentName:"p"},{src:"assets/slack-apps/tutorials/channelcheck/firstformatchannel.png",alt:"assets/slack-apps/tutorials/channelcheck/firstformatchannel.png"}))),Object(c.b)("ol",{start:4},Object(c.b)("li",{parentName:"ol"},"Return to your ",Object(c.b)("inlineCode",{parentName:"li"},"checkForNewChannels")," Cron, and add a line to format the ",Object(c.b)("inlineCode",{parentName:"li"},"newChannels")," list you previously generated. Press the play button.")),Object(c.b)("p",null,Object(c.b)("img",Object(n.a)({parentName:"p"},{src:"assets/slack-apps/tutorials/channelcheck/checkfornewchannelslist.png",alt:"assets/slack-apps/tutorials/channelcheck/checkfornewchannelslist.png"}))),Object(c.b)("ol",{start:5},Object(c.b)("li",{parentName:"ol"},"Return to your ",Object(c.b)("inlineCode",{parentName:"li"},"formatChannelList")," function and place your carat over the top dot (trace) on the left. You will see your ",Object(c.b)("inlineCode",{parentName:"li"},"channelList")," trace - now you can work with that data in order to format your list.")),Object(c.b)("p",null,Object(c.b)("img",Object(n.a)({parentName:"p"},{src:"assets/slack-apps/tutorials/channelcheck/formatchannellist.png",alt:"assets/slack-apps/tutorials/channelcheck/formatchannellist.png"}))),Object(c.b)("ol",{start:6},Object(c.b)("li",{parentName:"ol"},"For our purposes, we're going to do a very simple amount of formatting - we're going to add the markdown Slack needs to make channel names links, and add information about the channel's purpose. However, lots of information about Slack channels is available. Type ",Object(c.b)("inlineCode",{parentName:"li"},"val.")," and scroll through the autocomplete to see all of your options.")),Object(c.b)("p",null,Object(c.b)("img",Object(n.a)({parentName:"p"},{src:"assets/slack-apps/tutorials/channelcheck/formatchannellistlong.png",alt:"assets/slack-apps/tutorials/channelcheck/formatchanellistlong.png"}))),Object(c.b)("ol",{start:7},Object(c.b)("li",{parentName:"ol"},Object(c.b)("p",{parentName:"li"},"In your ",Object(c.b)("inlineCode",{parentName:"p"},"checkForNewChannels")," Cron, rerun ",Object(c.b)("inlineCode",{parentName:"p"},"formatChannelList")," to update the value of ",Object(c.b)("inlineCode",{parentName:"p"},"formattedList"),".")),Object(c.b)("li",{parentName:"ol"},Object(c.b)("p",{parentName:"li"},"Add a check for the length of the list - we're going to print out something different if there have been no new channels."))),Object(c.b)("p",null,Object(c.b)("img",Object(n.a)({parentName:"p"},{src:"assets/slack-apps/tutorials/channelcheck/listlength.png",alt:"assets/slack-apps/tutorials/channelcheck/listlength.png"}))),Object(c.b)("ol",{start:9},Object(c.b)("li",{parentName:"ol"},"The full code is going to look like this - if there are entries in the list, we'll post an announcement message and then the list of new channels. You'll notice that we also use the ",Object(c.b)("a",Object(n.a)({parentName:"li"},{href:"../slack-packages#postmarkdownmessage"}),Object(c.b)("inlineCode",{parentName:"a"},"postMarkDownMessage")," Slack function")," to simplify the posting of the message.")),Object(c.b)("p",null,Object(c.b)("img",Object(n.a)({parentName:"p"},{src:"assets/slack-apps/tutorials/channelcheck/fullcheckfornewchannels.png",alt:"assets/slack-apps/tutorials/channelcheck/fullcheckfornewchannels.png"}))),Object(c.b)("ol",{start:10},Object(c.b)("li",{parentName:"ol"},"To make our code a little bit cleaner, we've pulled the logic of posting the list of new channels out into a function. This function iterates through the list it is given and posts a markdown message to Slack for each entry.")),Object(c.b)("p",null,Object(c.b)("img",Object(n.a)({parentName:"p"},{src:"assets/slack-apps/tutorials/channelcheck/postlist.png",alt:"assets/slack-apps/tutorials/channelcheck/postlist.png"}))),Object(c.b)("ol",{start:11},Object(c.b)("li",{parentName:"ol"},"Once you've completed all of your code, run the Cron again. A message will appear in the channel you selected.")),Object(c.b)("p",null,Object(c.b)("img",Object(n.a)({parentName:"p"},{src:"assets/slack-apps/tutorials/channelcheck/newchannelpost.png",alt:"assets/slack-apps/tutorials/channelcheck/newchannelpost.png"}))),Object(c.b)("p",null,"Congratulations - you now have a Slack app that will post every 24 hours with any new channels created since it last posted."))}p.isMDXComponent=!0},241:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return m}));var n=a(0),l=a.n(n);function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){c(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,l=function(e,t){if(null==e)return{};var a,n,l={},c=Object.keys(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||(l[a]=e[a]);return l}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var i=l.a.createContext({}),p=function(e){var t=l.a.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},b=function(e){var t=p(e.components);return l.a.createElement(i.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return l.a.createElement(l.a.Fragment,{},t)}},u=l.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,c=e.originalType,o=e.parentName,i=s(e,["components","mdxType","originalType","parentName"]),b=p(a),u=n,m=b["".concat(o,".").concat(u)]||b[u]||h[u]||c;return a?l.a.createElement(m,r(r({ref:t},i),{},{components:a})):l.a.createElement(m,r({ref:t},i))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var c=a.length,o=new Array(c);o[0]=u;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:n,o[1]=r;for(var i=2;i<c;i++)o[i]=a[i];return l.a.createElement.apply(null,o)}return l.a.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);